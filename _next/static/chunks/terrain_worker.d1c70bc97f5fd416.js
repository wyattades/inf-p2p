!function(){var e={1620:function(e,r,n){"use strict";var t=n(7568),a=n(6042),o=n(9396),c=n(4051),u=n.n(c),i=n(6486),s=n(9477),f=128,l=function(e){return(0,i.pick)(e,"array","itemSize","normalized")},d=n(1438),v=n(2951),p=n(9815),h=n(8957),b=function(){function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,a=this;(0,d.Z)(this,e),this.name=r,this.version=n,this.storeName="chunks-".concat(r),this.disabled=!1,this.db=new Proxy({},{get:function(e,r){var n=a;return(0,t.Z)(u().mark((function e(){var t,a,o,c,i=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,a=new Array(t),o=0;o<t;o++)a[o]=i[o];return e.next=4,n._createDbPromise||(n._createDbPromise=n.createDb());case 4:return n.db=e.sent,e.abrupt("return",(c=n.db)[r].apply(c,(0,p.Z)(a)));case 6:case"end":return e.stop()}}),e)})))}})}return(0,v.Z)(e,[{key:"createDb",value:function(){var e=this;return(0,h.X3)("mapcache",this.version,{upgrade:function(r,n,t){console.log("Upgrading object store:",n,"->",t);var a=r.createObjectStore(e.storeName,{keyPath:["x","z"]});console.log("Created object store:",a.name)}})}},{key:"saveChunk",value:function(e,r,n){var a=this;return(0,t.Z)(u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a.disabled){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,a.db.put(a.storeName,{x:e,z:r,chunkData:n,modified:Date.now()});case 4:case"end":return t.stop()}}),t)})))()}},{key:"loadChunk",value:function(e,r){var n=this;return(0,t.Z)(u().mark((function t(){var a;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.disabled){t.next=2;break}return t.abrupt("return",null);case 2:return t.next=4,n.db.get(n.storeName,[e,r]);case 4:return a=t.sent,t.abrupt("return",a&&a.chunkData||null);case 6:case"end":return t.stop()}}),t)})))()}},{key:"clear",value:function(){var e=this;return(0,t.Z)(u().mark((function r(){return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.disabled){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,e.db.clear(e.storeName);case 4:case"end":return r.stop()}}),r)})))()}}]),e}(),k=n(6377),x=n.n(k),w=n(7048),y=n(3431),m=function(e,r,n){return function(e){var r=e.seed,n=e.scale,t=void 0===n?100:n,a=e.octaves,o=void 0===a?8:a,c=e.persistance,u=void 0===c?.5:c,i=e.lacunarity,s=void 0===i?2:i,l=e.offset,d=void 0===l?{x:0,y:0}:l;t<=0&&(t=1e-4);for(var v=new Float32Array(16384),p=new(x())(r),h=new w.ZP(r),b=0,k=1,y=[],m=0;m<o;m++){var g=2e5*p.quick()-1e5+d.x,C=2e5*p.quick()-1e5-d.y;y.push({x:g,y:C}),b+=k,k*=u}for(var j=0;j<f;j++)for(var O=0;O<f;O++){k=1;for(var Z=1,_=0,P=0;P<o;P++){var I=(O-64+y[P].x)/t*Z,D=(j-64+y[P].y)/t*Z;_+=h.noise2D(I,D)*k,k*=u,Z*=s}v[O*f+j]=Math.max(0,(_+1)/(1.16*b))}return v}({seed:e,offset:{x:127*n,y:127*-r}})},g=n.n(y)()(1,0,.85,.85),C=u().mark(z),j=[{d:.3,c:3367874},{d:.35,c:3630791},{d:.4,c:13685120},{d:.55,c:5740312},{d:.6,c:4155925},{d:.7,c:6112318},{d:.9,c:5061434},{d:100,c:16776959}],O=new s.Ilk,Z=!0,_=!1,P=void 0;try{for(var I,D=j[Symbol.iterator]();!(Z=(I=D.next()).done);Z=!0){var N=I.value;O.set(N.c),N.r=255*O.r|0,N.g=255*O.g|0,N.b=255*O.b|0}}catch(F){_=!0,P=F}finally{try{Z||null==D.return||D.return()}finally{if(_)throw P}}var S=function(e){var r=!0,n=!1,t=void 0;try{for(var a,o=j[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var c=a.value;if(e<=c.d)return c}}catch(F){n=!0,t=F}finally{try{r||null==o.return||o.return()}finally{if(n)throw t}}return j[0]};function z(e){var r,n,t,a,o,c,i;return u().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:r=0;case 1:if(!(r<127)){u.next=19;break}n=0;case 3:if(!(n<127)){u.next=16;break}return t=e[r*f+n],a=e[r*f+n+1],o=e[(r+1)*f+n],c=e[(r+1)*f+n+1],i=S(0===(s=[a,c,o,t].filter(Boolean)).length?0:s.reduce((function(e,r){return e+r}),0)/s.length),u.next=11,i;case 11:return u.next=13,i;case 13:n++,u.next=3;break;case 16:r++,u.next=1;break;case 19:case"end":return u.stop()}var s}),C)}console.log("Init terrain worker");var E=new b("world1"),M=new s._12(256,256,127,127);M.rotateX(-Math.PI/2);var T=new s.TlE(new Uint8Array(290322),3,!0),q=function(e,r){var n=M.clone(),t=m("a-19sgfu4281",e,r),c=T.clone(),u=c.array,s=0,f=!0,d=!1,v=void 0;try{for(var p,h=z(t)[Symbol.iterator]();!(f=(p=h.next()).done);f=!0){var b=p.value;u[s]=u[s+3]=u[s+6]=b.r,u[s+1]=u[s+4]=u[s+7]=b.g,u[s+2]=u[s+5]=u[s+8]=b.b,s+=9}}catch(F){d=!0,v=F}finally{try{f||null==h.return||h.return()}finally{if(d)throw v}}t=function(e){for(var r=0;r<e.length;r++)e[r]=(0,i.round)(60*g(e[r]),8);return e}(t);for(var k=n.attributes.position.array,x=0,w=0,y=t.length;x<y;x++,w+=3)k[w+1]=t[x];(n=n.toNonIndexed()).setAttribute("color",c);var C=function(e){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e.constructor(e.length),n=0|Math.sqrt(e.length),t=0;t<n;t++)for(var a=0;a<n;a++)r[t*n+a]=e[a*n+t];return r}(t);return(0,o.Z)((0,a.Z)({},(0,i.mapValues)(n.attributes,l)),{heightsArray:C})},A=function(){var e=(0,t.Z)(u().mark((function e(r){var n,t,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.x,t=r.z,(0,i.isInteger)(n)&&(0,i.isInteger)(t)){e.next=3;break}return e.abrupt("return",console.warn("Invalid loadChunk args: ".concat(n,",").concat(t)));case 3:return console.debug("terrain.worker request loadChunk:",n,t),e.prev=5,e.next=8,E.loadChunk(n,t);case 8:a=e.sent,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(5),console.warn("loadChunk error:",e.t0);case 14:if(a){e.next=24;break}return a=q(n,t),e.prev=16,e.next=19,E.saveChunk(n,t,a);case 19:e.next=24;break;case 21:e.prev=21,e.t1=e.catch(16),console.warn("saveChunk error:",e.t1);case 24:console.debug("terrain.worker sending chunk:",n,t),self.postMessage({cmd:"terrain",x:n,z:t,attributes:a},Object.values(a).map((function(e){var r;return e.buffer||(null===(r=e.array)||void 0===r?void 0:r.buffer)})).filter(Boolean));case 26:case"end":return e.stop()}}),e,null,[[5,11],[16,21]])})));return function(r){return e.apply(this,arguments)}}(),U=function(){var e=(0,t.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("terrain.worker request clearCache"),e.prev=1,e.next=4,E.clear();case 4:console.debug("terrain.worker clearCache complete"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.warn("clearCache",e.t0);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(){return e.apply(this,arguments)}}();self.onmessage=function(){var e=(0,t.Z)(u().mark((function e(r){var n,t,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r.data,t=null,a=null,e.prev=2,e.t0=n.cmd,e.next="loadChunk"===e.t0?6:"clearCache"===e.t0?10:14;break;case 6:return e.next=8,A(n);case 8:return t=e.sent,e.abrupt("break",15);case 10:return e.next=12,U();case 12:return t=e.sent,e.abrupt("break",15);case 14:throw new Error("Unknown command: ".concat(n.cmd));case 15:e.next=21;break;case 17:e.prev=17,e.t1=e.catch(2),console.error("terrain.worker error:",e.t1),a=e.t1;case 21:null!=n.cmdId&&self.postMessage({cmd:"worker_response",cmdId:n.cmdId,response:t,error:a?a.toString():null});case 22:case"end":return e.stop()}}),e,null,[[2,17]])})));return function(r){return e.apply(this,arguments)}}()},5042:function(){}},r={};function n(t){var a=r[t];if(void 0!==a)return a.exports;var o=r[t]={id:t,loaded:!1,exports:{}},c=!0;try{e[t].call(o.exports,o,o.exports,n),c=!1}finally{c&&delete r[t]}return o.loaded=!0,o.exports}n.m=e,n.x=function(){var e=n.O(void 0,[737,662,254],(function(){return n(1620)}));return e=n.O(e)},n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},function(){var e=[];n.O=function(r,t,a,o){if(!t){var c=1/0;for(f=0;f<e.length;f++){t=e[f][0],a=e[f][1],o=e[f][2];for(var u=!0,i=0;i<t.length;i++)(!1&o||c>=o)&&Object.keys(n.O).every((function(e){return n.O[e](t[i])}))?t.splice(i--,1):(u=!1,o<c&&(c=o));if(u){e.splice(f--,1);var s=a();void 0!==s&&(r=s)}}return r}o=o||0;for(var f=e.length;f>0&&e[f-1][2]>o;f--)e[f]=e[f-1];e[f]=[t,a,o]}}(),n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,{a:r}),r},n.d=function(e,r){for(var t in r)n.o(r,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(r,t){return n.f[t](e,r),r}),[]))},n.u=function(e){return 662===e?"static/chunks/29107295-fbcfe2172188e46f.js":"static/chunks/"+(737===e?"fb7d5399":e)+"."+{254:"c67230b771eda360",737:"3200eb89c31359d5"}[e]+".js"},n.miniCssF=function(e){},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},n.j=218,function(){var e;n.tt=function(){return void 0===e&&(e={createScriptURL:function(e){return e}},"undefined"!==typeof trustedTypes&&trustedTypes.createPolicy&&(e=trustedTypes.createPolicy("nextjs#bundler",e))),e}}(),n.tu=function(e){return n.tt().createScriptURL(e)},n.p="/_next/",function(){var e={218:1};n.f.i=function(r,t){e[r]||importScripts(n.tu(n.p+n.u(r)))};var r=self.webpackChunk_N_E=self.webpackChunk_N_E||[],t=r.push.bind(r);r.push=function(r){var a=r[0],o=r[1],c=r[2];for(var u in o)n.o(o,u)&&(n.m[u]=o[u]);for(c&&c(n);a.length;)e[a.pop()]=1;t(r)}}(),function(){var e=n.x;n.x=function(){return Promise.all([737,662,254].map(n.e,n)).then(e)}}();var t=n.x();_N_E=t}();